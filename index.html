<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>משחק זווית - צילום</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Rubik', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f4f8;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 800px;
            width: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding-bottom: 20px;
        }

        .question-text {
            padding: 25px 30px;
            font-size: 1.1rem;
            line-height: 1.6;
            color: #333;
            text-align: right;
        }

        /* אזור המשחק */
        .game-area {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
        }

        .image-wrapper {
            position: relative;
            width: 100%;
            user-select: none;
        }

        .image-wrapper img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
            pointer-events: none;
        }

        .overlay-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* אלמנטים אינטראקטיביים */
        .handle {
            cursor: grab;
            pointer-events: auto;
            transition: r 0.2s ease, fill 0.2s ease;
        }

        .handle:hover {
            r: 14;
            fill: #158bc4;
        }

        .handle:active {
            cursor: grabbing;
        }

        /* משוב */
        .feedback {
            min-height: 24px;
            margin: 10px 30px;
            padding: 15px;
            font-weight: 500;
            text-align: center;
            border-radius: 8px;
            font-size: 1rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: pre-line; /* מאפשר ירידת שורה בטקסט */
            line-height: 1.5;
        }

        .feedback.visible {
            opacity: 1;
        }

        .feedback.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* כפתור הגשה מרכזי */
        .footer-center {
            display: flex;
            justify-content: center;
            padding-top: 10px;
        }

        .btn-submit {
            padding: 12px 40px;
            border-radius: 50px;
            font-family: 'Rubik', sans-serif;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            background-color: #1DA1E1;
            color: white;
            box-shadow: 0 4px 6px rgba(29, 161, 225, 0.3);
            transition: all 0.3s ease;
        }

        .btn-submit:hover:not(.disable) {
            background-color: #168dc7;
            transform: translateY(-2px);
        }

        .btn-submit.disable {
            background-color: #bdc3c7;
            color: #fff;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

    </style>
</head>
<body>

    <main class="card">
        

        <div class="game-area">
            <div class="image-wrapper">
                <img src="que2-img.png" alt="תרשים צילום">
                
                <svg class="overlay-svg" viewBox="0 0 735 687" preserveAspectRatio="xMidYMid slice">
                    <line id="redLine" 
                          x1="378" y1="503" 
                          x2="575" y2="369" 
                          stroke="#E04557" stroke-width="10" stroke-linecap="round" />

                    <line id="blueLine" 
                          x1="378" y1="503" 
                          x2="216" y2="423" 
                          stroke="#1DA1E1" stroke-width="10" stroke-linecap="round" />

                    <circle id="blueHandle" 
                            class="handle" 
                            cx="216" cy="423" 
                            r="15" 
                            fill="#1DA1E1" stroke="white" stroke-width="2" />
                </svg>
            </div>
        </div>

        <div id="feedbackBox" class="feedback" aria-live="polite"></div>

        <div class="footer-center">
            <button id="submitBtn" class="btn-submit disable">הגשה לבדיקה</button>
        </div>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const svg = document.querySelector('.overlay-svg');
            const handle = document.getElementById('blueHandle');
            const blueLine = document.getElementById('blueLine');
            const submitBtn = document.getElementById('submitBtn');
            const feedbackBox = document.getElementById('feedbackBox');

            // קואורדינטות מרכז הקודקוד (מקור הקרניים)
            const centerX = 378;
            const centerY = 503;
            
            // קואורדינטות היעד המדויקות (לתשובה נכונה)
            const targetX = 174;
            const targetY = 321;
            
            const minLength = 50; 

            let isDragging = false;
            let hasMoved = false; 

            function getMousePosition(evt) {
                const CTM = svg.getScreenCTM();
                if (evt.touches) { evt = evt.touches[0]; }
                return {
                    x: (evt.clientX - CTM.e) / CTM.a,
                    y: (evt.clientY - CTM.f) / CTM.d
                };
            }

            function drag(evt) {
                if (!isDragging) return;
                evt.preventDefault();

                if (!hasMoved) {
                    hasMoved = true;
                    submitBtn.classList.remove('disable'); 
                }

                // איפוס הודעת המשוב בזמן גרירה
                feedbackBox.className = 'feedback';
                feedbackBox.innerText = '';
                blueLine.setAttribute('stroke', '#1DA1E1'); // החזרת צבע לכחול

                const coord = getMousePosition(evt);
                let dx = coord.x - centerX;
                let dy = coord.y - centerY;

                // חישוב מרחק ושמירה על מינימום
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < minLength) {
                    const angle = Math.atan2(dy, dx);
                    dx = minLength * Math.cos(angle);
                    dy = minLength * Math.sin(angle);
                }

                const newX = centerX + dx;
                const newY = centerY + dy;

                handle.setAttribute('cx', newX);
                handle.setAttribute('cy', newY);
                blueLine.setAttribute('x2', newX);
                blueLine.setAttribute('y2', newY);
            }

            function startDrag(evt) {
                isDragging = true;
            }

            function endDrag() {
                isDragging = false;
            }

            // --- לוגיקת בדיקה ---
            submitBtn.addEventListener('click', () => {
                if (submitBtn.classList.contains('disable')) return;

                // 1. חישוב הזווית הנוכחית של המשתמש
                const currentX = parseFloat(handle.getAttribute('cx'));
                const currentY = parseFloat(handle.getAttribute('cy'));
                const userAngle = Math.atan2(currentY - centerY, currentX - centerX);

                // 2. חישוב זווית היעד המדויקת לפי הנקודה (174, 321)
                const targetAngle = Math.atan2(targetY - centerY, targetX - centerX);

                // 3. חישוב ההפרש בין הזוויות (בערך מוחלט) במעלות
                let diff = Math.abs(userAngle - targetAngle) * (180 / Math.PI);
                
                // טיפול במעבר ה-180 מעלות (אם רלוונטי, כאן לא קריטי אבל טוב ליתר ביטחון)
                if (diff > 180) diff = 360 - diff;

                // 4. הגדרת סף דיוק (Tolerance) - כ-5 מעלות לכל כיוון נחשב תקין
                const toleranceDegrees = 5;

                if (diff <= toleranceDegrees) {
                    // --- תשובה נכונה ---
                    feedbackBox.innerText = "כל הכבוד! נכון מאוד.";
                    feedbackBox.className = "feedback visible success";
                    blueLine.setAttribute('stroke', '#28a745'); // ירוק
                } else {
                    // --- תשובה שגויה ---
                    // שימוש ב-innerHTML לא נדרש כי הגדרנו white-space: pre-line ב-CSS
                    feedbackBox.innerText = "טעית.\nלא נורא, זו רק ההתחלה.\nנסה לסגור / לפתוח מעט את שוקי הזווית כדי להתמקד רק בקבוצה.";
                    feedbackBox.className = "feedback visible error";
                    blueLine.setAttribute('stroke', '#dc3545'); // אדום
                }
            });

            handle.addEventListener('mousedown', startDrag);
            handle.addEventListener('touchstart', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
        });
    </script>
</body>
</html>
